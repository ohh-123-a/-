## [9月24日 (Shell 脚本：日志分析)]()

**学习目标：** 掌握使用 Bash 脚本对日志进行过滤统计的基本方法，学会使用 `grep`、`awk`、`uniq` 等工具提取关键信息。例如，通过日志分析可以实时监控 CDN 边缘服务器的访问量与错误情况[blog.csdn.net](https://blog.csdn.net/weixin_44120785/article/details/134960176#:~:text=)[cnblogs.com](https://www.cnblogs.com/wuchangsoft/p/18497730#:~:text=LOG_FILE%3D)。
 **任务描述：** 以 CDN 边缘节点（如 Nginx）日志为例，编写一个 Shell 脚本，统计访问日志的总请求数、错误日志条目数，并列出产生 404 错误的 IP 及其出现次数，最后展示最近几条错误日志。

- 第一步：定义日志文件路径，如 `access.log` 和 `error.log`。
- 第二步：使用 `wc -l` 统计总行数，使用 `grep -c` 或 `awk` 统计特定关键字（如“error”或404）的出现次数[blog.csdn.net](https://blog.csdn.net/weixin_44120785/article/details/134960176#:~:text=)。
- 第三步：结合 `awk`+`sort`+`uniq` 等命令对日志字段进行分组统计[cnblogs.com](https://www.cnblogs.com/wuchangsoft/p/18497730#:~:text=LOG_FILE%3D)。例如，提取访问日志中返回码为 404 的 IP 地址并统计出现次数。
- 第四步：使用 `tail` 查看错误日志的最新记录。

**参考脚本/命令：**

```
#!/bin/bash
# 日志分析脚本示例：统计访问量和错误信息
ACCESS_LOG="/var/log/nginx/access.log"
ERROR_LOG="/var/log/nginx/error.log"

# 统计访问日志的总请求数
echo "访问日志总请求数：$(wc -l < "$ACCESS_LOG")"

# 统计错误日志条目数
echo "错误日志总条数：$(wc -l < "$ERROR_LOG")"

# 统计访问日志中返回404的IP出现次数
echo "出现404错误的IP及出现次数："
awk '$9 == 404 {print $1}' "$ACCESS_LOG" | sort | uniq -c | sort -nr

# 显示错误日志的最后5条记录
echo "最近5条错误日志："
tail -n 5 "$ERROR_LOG"
```

以上脚本使用了 `wc`、`awk`、`sort`、`uniq` 等常用命令对日志进行处理[blog.csdn.net](https://blog.csdn.net/weixin_44120785/article/details/134960176#:~:text=)[cnblogs.com](https://www.cnblogs.com/wuchangsoft/p/18497730#:~:text=LOG_FILE%3D)。比如，`awk '$9 == 404 {print $1}'` 提取返回码为404的访问日志条目的IP字段并统计次数[cnblogs.com](https://www.cnblogs.com/wuchangsoft/p/18497730#:~:text=LOG_FILE%3D)。



grep

```
-c 统计行数
-o 输出匹配部分
```



awk





sed

```
-s 替换
-g 全局替换
-i 
```



wc





```
grepo'ERRoR' /path/to/logfile.log | cut -d' ' -f4- 丨 sort | uniq -c
```

sort 排序

uniq 统计重复行数量

