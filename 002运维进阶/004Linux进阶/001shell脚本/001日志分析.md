# 9.24–9.30 运维实习生夜班学习计划

## 9月24日 (Shell 脚本：日志分析)

**学习目标：** 掌握使用 Bash 脚本对日志进行过滤统计的基本方法，学会使用 `grep`、`awk`、`uniq` 等工具提取关键信息。例如，通过日志分析可以实时监控 CDN 边缘服务器的访问量与错误情况[blog.csdn.net](https://blog.csdn.net/weixin_44120785/article/details/134960176#:~:text=)[cnblogs.com](https://www.cnblogs.com/wuchangsoft/p/18497730#:~:text=LOG_FILE%3D)。
 **任务描述：** 以 CDN 边缘节点（如 Nginx）日志为例，编写一个 Shell 脚本，统计访问日志的总请求数、错误日志条目数，并列出产生 404 错误的 IP 及其出现次数，最后展示最近几条错误日志。

- 第一步：定义日志文件路径，如 `access.log` 和 `error.log`。
- 第二步：使用 `wc -l` 统计总行数，使用 `grep -c` 或 `awk` 统计特定关键字（如“error”或404）的出现次数[blog.csdn.net](https://blog.csdn.net/weixin_44120785/article/details/134960176#:~:text=)。
- 第三步：结合 `awk`+`sort`+`uniq` 等命令对日志字段进行分组统计[cnblogs.com](https://www.cnblogs.com/wuchangsoft/p/18497730#:~:text=LOG_FILE%3D)。例如，提取访问日志中返回码为 404 的 IP 地址并统计出现次数。
- 第四步：使用 `tail` 查看错误日志的最新记录。

**参考脚本/命令：**

```
#!/bin/bash
# 日志分析脚本示例：统计访问量和错误信息
ACCESS_LOG="/var/log/nginx/access.log"
ERROR_LOG="/var/log/nginx/error.log"

# 统计访问日志的总请求数
echo "访问日志总请求数：$(wc -l < "$ACCESS_LOG")"

# 统计错误日志条目数
echo "错误日志总条数：$(wc -l < "$ERROR_LOG")"

# 统计访问日志中返回404的IP出现次数
echo "出现404错误的IP及出现次数："
awk '$9 == 404 {print $1}' "$ACCESS_LOG" | sort | uniq -c | sort -nr

# 显示错误日志的最后5条记录
echo "最近5条错误日志："
tail -n 5 "$ERROR_LOG"
```

以上脚本使用了 `wc`、`awk`、`sort`、`uniq` 等常用命令对日志进行处理[blog.csdn.net](https://blog.csdn.net/weixin_44120785/article/details/134960176#:~:text=)[cnblogs.com](https://www.cnblogs.com/wuchangsoft/p/18497730#:~:text=LOG_FILE%3D)。比如，`awk '$9 == 404 {print $1}'` 提取返回码为404的访问日志条目的IP字段并统计次数[cnblogs.com](https://www.cnblogs.com/wuchangsoft/p/18497730#:~:text=LOG_FILE%3D)

grep

```shell
grep -v '^$' nowcoder.txt #-v排除空行
```

sed 

```shell
sed -n 5p a.txt #打印第五行
sed '/^$/d' nowcoder.txt #删除空行并输出内容
```

awk

```shell
NR==5 行
NF==5 列
NR（Number of Records）：表示当前处理的行号（从 1 开始计数，跨文件处理时会累计计数）。
NF（Number of Fields）：表示当前行的字段数（列数）（默认以空格 / 制表符为分隔符）。
=============================================================
awk '/^$/ {print NR}' nowcoder.txt 
/^$/：这是一个正则表达式，表示匹配空行（^表示行开头，$表示行结尾，中间没有任何字符）
NR：awk的内置变量，表示当前处理的行号
{print NR}：当匹配到空行时，打印当前行号
=============================================================
awk 'NF'nowcoder.txt # NF表示当前行的字段数，空行NF=0，不输出
==============================================================
#!/bin/bash

# 统计并输出字母数小于8的单词（修正版）
awk '{
    # awk的for循环语法：不需要双括号和do
    for (i = 1; i <= NF; i++) {
        # if语句用大括号包裹，符合awk语法规范
        if (length($i) < 8) {
            print $i
        }
    }
}' nowcoder.txt
=============================================================
#!/bin/bash

# 计算所有进程的内存占用总和（RSS列，单位KB）
awk '
    NR > 1 {  # 跳过第一行标题行（NR表示行号，NR>1即从第二行开始处理）
        sum += $6  # 累加第六列（RSS）的值到sum变量
    }
    END {  # 所有行处理完后执行
        print sum  # 输出总和
    }
' nowcoder.txt
=============================================================
#!/bin/bash

# 提取第二列单词并统计次数，筛选重复项，按要求排序
awk '{
    # 提取第二列单词并统计出现次数
    word = $2
    count[word]++
}
END {
    # 只输出出现次数大于1的单词，格式为"次数 单词"
    for (word in count) {
        if (count[word] > 1) {
            print count[word], word
        }
    }
}' nowcoder.txt | sort -n -k1,1 -k2,2
```

sort

```shell
sort -nr 
#sort 可针对文本文件的内容，以行为单位来排序。-n 参数表示根据数字大小排序；-r 对应英文单词是 reverse，意思是反转排序结果；sort 默认是从小到大排序，加上这个参数可以实现从大到小排序。
sort -n -k2 处理后：
-k2 表示按第 2 列排序（即词频列）。
-n 表示按数值排序（而非字符串排序
```

wc

```shell
wc -l nownoder.txt | awk '{print $1}'
```

uniq

```shell
uniq -c 
#uniq 可检查文本文件中重复出现的行列。-c 或 --count 在每列旁边显示该行重复出现的次数。
```

cut

```

```

seq

```shell
seq 0 7 500
#seq 0 7 500表示从 0 开始，每次加 7，直到不超过 500，直接输出所有结果
```

count数组

```bash
#!/bin/bash

# 统计每个单词出现次数并按词频升序排列
awk '{
    # 遍历当前行的所有单词（默认按空格分割，自动处理多个连续空格）
    for (i = 1; i <= NF; i++) {
        # 用数组count统计每个单词的出现次数
        count[$i]++
    }
}
END {
    # 遍历数组，打印每个单词及其出现次数
    for (word in count) {
        print word, count[word]
    }
}' nowcoder.txt | sort -n -k2  # 按第二列（词频）数值升序排序

    
```

![屏幕截图 2025-10-11 192505](C:\Users\A1687\Pictures\Screenshots\屏幕截图 2025-10-11 192505.png)



​	
