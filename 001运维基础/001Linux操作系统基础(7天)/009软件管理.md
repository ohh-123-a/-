# 🧩 009 软件管理

------

## 0️⃣ 🧭 软件源与仓库原理

在 Linux 中，软件不是去官网下载 `.exe` 安装，而是通过 **仓库（Repository）** 来统一管理的。
 这相当于 Linux 的 “App Store”。

### 🏦 1️⃣ 什么是软件仓库（Repository）

仓库（Repo）是一台存放大量软件包的服务器。
 系统通过网络连接仓库，下载、安装或更新软件。

📦 常见仓库示例：

| 系统         | 默认仓库地址                            |
| ------------ | --------------------------------------- |
| Ubuntu       | `http://archive.ubuntu.com/ubuntu/`     |
| CentOS       | `http://mirror.centos.org/centos/`      |
| 阿里云镜像   | `http://mirrors.aliyun.com/`            |
| 清华大学镜像 | `https://mirrors.tuna.tsinghua.edu.cn/` |

仓库目录结构：

```bash
Packages/             # 存放 .deb 或 .rpm 软件包
repodata/             # 元数据（包名、依赖）
Release / repomd.xml  # 索引文件
```

系统执行 `apt update` 或 `yum makecache`
 其实就是下载这些索引文件，更新本地软件目录缓存。

------

### 🔍 2️⃣ 什么是“源”（Source）

“源”就是系统访问仓库的 **网络地址**。
 比如告诉系统：

> “到哪里下载软件。”

Ubuntu 的源配置文件：

```bash
cat /etc/apt/sources.list
```

示例：

```bash
deb http://archive.ubuntu.com/ubuntu/ jammy main restricted universe multiverse
```

这里：

- `deb`：表示这是二进制包源；
- `http://archive.ubuntu.com/ubuntu/`：服务器地址；
- `jammy`：系统版本；
- `main restricted ...`：仓库分类。

更换国内镜像（加速下载）：

```bash
deb http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse
```

⚙️ **换源就是换下载服务器地址**，逻辑不变。

------

### 🧰 3️⃣ 为什么要更换源

| 原因       | 说明                             |
| ---------- | -------------------------------- |
| 🌍 网络问题 | 默认源在国外，访问慢甚至超时     |
| ⚡ 加速下载 | 镜像站通常位于国内或CDN          |
| 🧱 企业定制 | 内网可搭建私有仓库，保证版本统一 |

------

### 🔄 4️⃣ 软件安装的完整流程

当你执行：

```bash
sudo apt install nginx
```

实际上发生了以下步骤👇

1️⃣ **读取本地缓存索引**（`/var/lib/apt/lists/`）
 2️⃣ **解析依赖关系**
 3️⃣ **从源下载 .deb 包**
 4️⃣ **调用 `dpkg` 解压并安装到系统目录**
 5️⃣ **执行后置脚本（启动服务等）**

📘 **可视化理解：**

```bash
用户命令  →  apt  →  sources.list  →  远程仓库下载包
                                       ↓
                                   dpkg 安装文件
```

`yum` / `dnf` 的流程一致，只是底层使用 `rpm` 而非 `dpkg`。

------

### 📦 5️⃣ rpm 与 deb 包

| 类型 | 适用系统                 | 管理工具      | 文件扩展名 |
| ---- | ------------------------ | ------------- | ---------- |
| RPM  | RedHat / CentOS / Fedora | rpm, yum, dnf | `.rpm`     |
| DEB  | Debian / Ubuntu          | dpkg, apt     | `.deb`     |

每个包中都包含：

- 二进制程序；
- 元信息（包名、版本、依赖）；
- 安装/卸载脚本。

🧩 **区别总结：**

- `apt` 调用 `dpkg`
- `yum` / `dnf` 调用 `rpm`
- 二者原理相同，只是生态不同。

------

### 🧠 6️⃣ 软件管理层级理解

| 层级 | 工具                  | 作用                   |
| ---- | --------------------- | ---------------------- |
| 底层 | `rpm` / `dpkg`        | 直接安装/卸载软件包    |
| 中层 | `yum` / `apt` / `dnf` | 自动解析依赖、联网下载 |
| 上层 | 仓库 / 源（repo）     | 存放软件和元数据       |
| 用户 | 命令行 / 图形工具     | 发起操作               |

💡 **一句话总结：**

> “仓库是商店，源是地址，包是商品，rpm/dpkg是安装工，yum/apt是经理。”

------

## 1️⃣ 📦 包管理工具

### 🧩 Debian / Ubuntu 系列

```bash
sudo apt update            # 更新软件源索引
sudo apt install nginx     # 安装软件
sudo apt remove nginx      # 删除软件
sudo apt purge nginx       # 删除含配置文件
sudo apt upgrade           # 升级所有软件包
```

查看包信息：

```bash
apt show nginx
```

清理缓存：

```bash
sudo apt clean
sudo apt autoremove
```

------

### 🧩 CentOS / RHEL 系列

```bash
sudo yum install httpd     # 安装软件
sudo yum remove httpd      # 卸载软件
sudo yum list installed    # 查看已安装软件
sudo yum update            # 更新系统软件
```

`dnf` 是 `yum` 的升级版（CentOS 8+）：

```bash
sudo dnf install nginx
sudo dnf update
```

查看仓库配置：

```bash
yum repolist all
dnf repolist
```

仓库配置文件路径：

```bash
/etc/yum.repos.d/
```

示例：

```bash
[base]
name=CentOS-$releasever - Base
baseurl=http://mirrors.aliyun.com/centos/$releasever/os/$basearch/
enabled=1
gpgcheck=1
```

------

## 2️⃣ ⚙️ 从源码编译安装

当官方仓库中无对应软件或需要定制编译选项时，可手动编译：

```bash
tar -xvf source.tar.gz
cd source
./configure --prefix=/usr/local/app
make
sudo make install
```

📘 常见流程：
 1️⃣ `configure` 检查依赖、生成Makefile
 2️⃣ `make` 编译
 3️⃣ `make install` 安装

删除时需手动执行：

```bash
sudo make uninstall
```

------

## ✅ 本节总结

| 模块       | 工具 / 文件                                   | 说明               |
| ---------- | --------------------------------------------- | ------------------ |
| 软件源     | `/etc/apt/sources.list` / `/etc/yum.repos.d/` | 存放仓库地址       |
| 包管理器   | `apt`, `yum`, `dnf`                           | 自动解析依赖与下载 |
| 底层安装器 | `dpkg`, `rpm`                                 | 实际执行安装任务   |
| 源码安装   | `./configure && make && make install`         | 手动编译安装       |
| 清理命令   | `apt clean`, `yum autoremove`                 | 清除缓存与依赖     |

------

💡 **记忆口诀：**

> “先懂仓库与源，再用 apt/yum 安装，源码编译为补充。”
>  —— Linux 软件管理三层逻辑。