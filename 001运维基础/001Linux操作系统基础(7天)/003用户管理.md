# 👤003 用户管理

------

## 1️⃣ 用户和组的管理

Linux 通过 **用户（User）** 与 **用户组（Group）** 来实现多用户协作与权限隔离。
 系统中的每个进程都以某个用户身份运行，不同用户的权限和资源范围不同。

------

### 👤 用户管理

#### 📌 用户基本操作

```bash
# 创建用户
sudo useradd username             # 创建新用户（不自动生成家目录）
sudo useradd -m username          # 创建新用户并自动生成家目录
sudo useradd -m -s /bin/bash user # 指定登录 shell

# 删除用户
sudo userdel username             # 删除用户但保留家目录
sudo userdel -r username          # 删除用户及家目录、邮件目录

# 修改用户
sudo usermod -aG groupname user   # 将用户加入附加组（不会覆盖已有组）
sudo usermod -s /bin/zsh user     # 修改用户默认 shell
sudo usermod -d /new/home user    # 修改用户家目录
sudo usermod -L user              # 锁定用户账号（禁止登录）
sudo usermod -U user              # 解锁用户账号
```

#### 🗂️ 用户信息文件

| 文件路径      | 作用说明                                              |
| ------------- | ----------------------------------------------------- |
| `/etc/passwd` | 存储用户的基本信息（用户名、UID、GID、家目录、shell） |
| `/etc/shadow` | 存储用户密码的加密信息（仅 root 可读）                |

查看用户信息示例：

```bash
cat /etc/passwd | grep username
```

典型条目结构：

```bash
username:x:1001:1001:User Name:/home/username:/bin/bash
```

字段含义：

| 字段     | 含义                                 |
| -------- | ------------------------------------ |
| username | 用户名                               |
| x        | 密码占位符（真实密码在 /etc/shadow） |
| UID      | 用户ID                               |
| GID      | 用户组ID                             |
| comment  | 用户说明信息                         |
| home     | 家目录路径                           |
| shell    | 登录shell                            |

------

### 👥 用户组管理

用户组用于集中管理权限，方便多个用户共享资源。

#### 📌 用户组操作

```bash
# 创建组
sudo groupadd groupname

# 删除组
sudo groupdel groupname

# 修改组名
sudo groupmod -n newgroup oldgroup

# 将用户添加到组
sudo usermod -aG groupname username

# 从组中移除用户（Debian/Ubuntu）
sudo gpasswd -d username groupname
```

#### 🧾 组信息文件

| 文件路径       | 作用说明                 |
| -------------- | ------------------------ |
| `/etc/group`   | 定义组名与组ID（GID）    |
| `/etc/gshadow` | 存储组密码（通常不使用） |

示例：

```bash
developers:x:1002:alice,bob
```

表示：

- 组名：developers
- GID：1002
- 成员：alice, bob

------

## 2️⃣ 用户权限

Linux 使用 **用户（User）**、**组（Group）**、**其他用户（Other）** 三种身份来控制访问权限。
 每种身份都拥有三种权限：

| 权限类型 | 含义                         | 符号 | 数值 |
| -------- | ---------------------------- | ---- | ---- |
| 读取     | 查看文件内容或列出目录       | r    | 4    |
| 写入     | 修改文件内容或创建、删除文件 | w    | 2    |
| 执行     | 运行程序或进入目录           | x    | 1    |

------

### 🧱 权限查看与修改

```bash
ls -l
# 输出示例
-rwxr-xr-- 1 root root 4096 Nov 8 09:30 test.sh
```

权限字段解释：

```bash
- [rwx][r-x][r--]
 │   │     └── 其他用户
 │   └──────── 组权限
 └──────────── 所有者权限
```

#### 修改权限命令

```bash
# 修改权限
chmod 755 file.txt           # rwxr-xr-x
chmod u+x script.sh          # 给所有者添加执行权限
chmod g-w file.txt           # 去掉组的写权限

# 修改文件所有者与组
chown user file.txt          # 修改所有者
chown user:group file.txt    # 修改所有者与所属组
chgrp group file.txt         # 仅修改所属组
```

#### 数字权限对照表

| 权限 | 数值 | 含义     |
| ---- | ---- | -------- |
| 7    | rwx  | 读写执行 |
| 6    | rw-  | 读写     |
| 5    | r-x  | 读执行   |
| 4    | r--  | 只读     |
| 0    | ---  | 无权限   |

------

### 🔒 特殊权限（高级）

| 权限           | 名称         | 作用                                                 |
| -------------- | ------------ | ---------------------------------------------------- |
| **SUID**       | Set User ID  | 以文件所有者身份执行程序（常见于 `/usr/bin/passwd`） |
| **SGID**       | Set Group ID | 新建文件继承父目录的组属性                           |
| **Sticky Bit** | 粘滞位       | 仅文件所有者能删除目录中文件（常见于 `/tmp`）        |

```bash
chmod 4755 file    # 设置 SUID
chmod 2755 dir     # 设置 SGID
chmod 1755 dir     # 设置粘滞位
```

------

## 3️⃣ sudo权限

`sudo` 命令用于让普通用户临时获得管理员权限执行操作。

### ⚙️ sudo 基本使用

```bash
# 临时使用 root 权限执行命令
sudo command

# 以其他用户身份执行命令
sudo -u username command

# 以 root 身份打开 Shell
sudo -i
```

------

### 🧩 sudo 配置文件

`sudo` 权限由 `/etc/sudoers` 管理，编辑时必须使用 `visudo` 以防语法错误：

```bash
sudo visudo
```

示例：

```bash
# 用户名  允许主机=(可切换身份) 可执行命令
alice    ALL=(ALL)       ALL
%admin   ALL=(ALL)       ALL
```

也可以通过 `/etc/sudoers.d/` 目录创建独立配置文件：

```bash
echo "bob ALL=(ALL) NOPASSWD:ALL" | sudo tee /etc/sudoers.d/bob
```

------

### ⚠️ 安全建议

- 不建议直接使用 root 登录系统。
- 仅为信任用户添加 sudo 权限。
- 配置 `NOPASSWD` 时需谨慎，会降低安全性。
- 检查 `/var/log/auth.log` 查看 sudo 使用记录。

------

✅ **总结**

- **用户与组管理**：`useradd`、`usermod`、`groupadd`
- **权限控制**：`chmod`、`chown`、`chgrp`
- **sudo 权限**：临时获取管理员能力

通过合理配置用户、组和权限，可以有效保障系统安全与多用户协作。