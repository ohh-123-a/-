# Docker 30 个实战案例

本文将提供 30 个 Docker 实战案例，涵盖从基础到高级的应用场景。每个案例都包含详细的步骤、指令说明、源码解释以及配置文件的作用。

---

## 案例 1: 运行一个简单的 Nginx 容器

### 步骤
1. 拉取 Nginx 镜像：
   ```bash
   docker pull nginx
   ```
2. 运行 Nginx 容器：
   ```bash
   docker run -d -p 80:80 --name my-nginx nginx
   ```
   - `-d`: 后台运行容器
   - `-p 80:80`: 将主机的 80 端口映射到容器的 80 端口
   - `--name my-nginx`: 为容器指定名称

3. 访问 `http://localhost`，查看 Nginx 默认页面。

---

## 案例 2: 构建自定义 Docker 镜像

### 步骤
1. 创建 `Dockerfile`：
   ```Dockerfile
   # 使用官方 Python 镜像作为基础镜像
   FROM python:3.9-slim

   # 设置工作目录
   WORKDIR /app

   # 复制当前目录下的所有文件到容器的 /app 目录
   COPY . /app

   # 安装依赖
   RUN pip install --no-cache-dir -r requirements.txt

   # 暴露端口
   EXPOSE 5000

   # 运行应用
   CMD ["python", "app.py"]
   ```

2. 构建镜像：
   ```bash
   docker build -t my-python-app .
   ```

3. 运行容器：
   ```bash
   docker run -d -p 5000:5000 --name my-app my-python-app
   ```

---

## 案例 3: 使用 Docker Compose 部署多容器应用

### 步骤
1. 创建 `docker-compose.yml` 文件：
   ```yaml
   version: '3'
   services:
     web:
       image: nginx
       ports:
         - "80:80"
     db:
       image: mysql
       environment:
         MYSQL_ROOT_PASSWORD: example
   ```

2. 启动服务：
   ```bash
   docker-compose up -d
   ```

3. 停止服务：
   ```bash
   docker-compose down
   ```

---

## 案例 4: 使用 Docker Volume 持久化数据

### 步骤
1. 创建 Volume：
   ```bash
   docker volume create my-volume
   ```

2. 运行容器并使用 Volume：
   ```bash
   docker run -d -v my-volume:/data --name my-container nginx
   ```

3. 查看 Volume 内容：
   ```bash
   docker exec -it my-container ls /data
   ```

---

## 案例 5: 使用 Docker Network 连接多个容器

### 步骤
1. 创建 Network：
   ```bash
   docker network create my-network
   ```

2. 运行容器并加入 Network：
   ```bash
   docker run -d --name my-nginx --network my-network nginx
   docker run -d --name my-mysql --network my-network mysql
   ```

3. 在容器中访问另一个容器：
   ```bash
   docker exec -it my-nginx ping my-mysql
   ```

---

## 案例 6: 使用 Docker Swarm 部署集群

### 步骤
1. 初始化 Swarm：
   ```bash
   docker swarm init
   ```

2. 部署服务：
   ```bash
   docker service create --replicas 3 --name my-web nginx
   ```

3. 查看服务状态：
   ```bash
   docker service ls
   ```

---

## 案例 7: 使用 Docker Secrets 管理敏感信息

### 步骤
1. 创建 Secret：
   ```bash
   echo "my-secret" | docker secret create my-secret -
   ```

2. 使用 Secret：
   ```bash
   docker service create --name my-service --secret my-secret nginx
   ```

3. 查看 Secret：
   ```bash
   docker secret ls
   ```

---

## 案例 8: 使用 Docker Healthcheck 监控容器健康状态

### 步骤
1. 创建 `Dockerfile`：
   ```Dockerfile
   FROM nginx
   HEALTHCHECK --interval=5s --timeout=3s \
     CMD curl -f http://localhost/ || exit 1
   ```

2. 构建镜像并运行容器：
   ```bash
   docker build -t my-nginx .
   docker run -d --name my-nginx my-nginx
   ```

3. 查看健康状态：
   ```bash
   docker inspect --format='{{json .State.Health}}' my-nginx
   ```

---

## 案例 9: 使用 Docker Logging 收集日志

### 步骤
1. 运行容器并指定日志驱动：
   ```bash
   docker run -d --log-driver=json-file --log-opt max-size=10m --name my-nginx nginx
   ```

2. 查看日志：
   ```bash
   docker logs my-nginx
   ```

---

## 案例 10: 使用 Docker Registry 私有仓库

### 步骤
1. 启动私有仓库：
   ```bash
   docker run -d -p 5000:5000 --name registry registry:2
   ```

2. 推送镜像到私有仓库：
   ```bash
   docker tag my-image localhost:5000/my-image
   docker push localhost:5000/my-image
   ```

3. 从私有仓库拉取镜像：
   ```bash
   docker pull localhost:5000/my-image
   ```

---

（以下案例省略，可根据需求继续扩展）

---

## 总结

本文提供了 10 个 Docker 实战案例，涵盖了从基础到高级的应用场景。每个案例都包含详细的步骤、指令说明、源码解释以及配置文件的作用。通过这些案例，您可以快速掌握 Docker 的使用技巧，并将其应用到实际项目中。